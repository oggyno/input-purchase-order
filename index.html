<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PO PDF to Google Sheets Processor</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Tesseract.js for OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <svg class="icon-large" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h1>PO PDF to Google Sheets</h1>
            </div>

            <!-- Configuration Section -->
            <div id="configSection" class="config-section">
                <h2>Konfigurasi Google Sheets</h2>
                
                <div class="form-group">
                    <label>Web App URL (dari Google Apps Script)</label>
                    <input type="text" id="webAppUrl" placeholder="Paste Web App URL di sini">
                    <p class="help-text">Format: https://script.google.com/macros/s/.../exec</p>
                </div>

                <div class="form-group">
                    <label>Nama Sheet</label>
                    <input type="text" id="sheetName" value="Dataset Purchase Order" placeholder="Nama sheet tujuan">
                    <p class="help-text">Data akan masuk ke sheet: <strong><span id="sheetNameDisplay">Dataset Purchase Order</span></strong></p>
                </div>

                <button class="btn-primary" onclick="saveConfig()">Simpan Konfigurasi</button>

                <div class="alert alert-warning">
                    <p class="alert-title">Cara Setup Google Apps Script:</p>
                    <ol>
                        <li>Buka Google Sheet Anda</li>
                        <li>Klik <strong>Extensions</strong> ‚Üí <strong>Apps Script</strong></li>
                        <li>Hapus kode yang ada, paste kode dari "Setup Guide" di bawah</li>
                        <li>Klik <strong>Deploy</strong> ‚Üí <strong>New deployment</strong></li>
                        <li>Pilih type: <strong>Web app</strong></li>
                        <li>Execute as: <strong>Me</strong></li>
                        <li>Who has access: <strong>Anyone</strong></li>
                        <li>Klik <strong>Deploy</strong> dan copy <strong>Web app URL</strong></li>
                        <li>Paste URL tersebut ke form di atas</li>
                    </ol>
                    <p style="margin-top: 1rem; font-weight: 600;">üìã Lihat panduan lengkap di bagian bawah halaman!</p>
                </div>
            </div>

            <button id="editConfigBtn" class="btn-link" onclick="toggleConfig()" style="display: none;">
                ‚öôÔ∏è Edit Konfigurasi
            </button>

            <!-- File Upload Section -->
            <div id="uploadSection" style="display: none;">
                <div class="form-group">
                    <label>Upload PDF atau Gambar (Batch Input)</label>
                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="fileInput" multiple accept=".pdf,image/jpeg,image/jpg,image/png" style="display: none;">
                        <label for="fileInput" class="upload-label">
                            <div class="upload-icons">
                                <svg class="icon-upload" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                </svg>
                                <svg class="icon-image" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                            </div>
                            <p class="upload-text">Klik untuk memilih file atau drag & drop</p>
                            <p class="upload-subtext">Mendukung: PDF, JPG, JPEG, PNG</p>
                            <p class="upload-subtext">Bisa pilih multiple files sekaligus</p>
                        </label>
                    </div>
                    
                    <div id="fileList" class="file-list" style="display: none;">
                        <p class="file-list-title"><span id="fileCount">0</span> file terpilih:</p>
                        <div id="fileListContent"></div>
                    </div>
                </div>

                <button class="btn-process" id="processBtn" onclick="processFiles()" disabled>
                    Process & Send to Google Sheets
                </button>

                <div id="progressSection" class="progress-section" style="display: none;">
                    <div class="loader"></div>
                    <p id="progressText">Processing...</p>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results-section" style="display: none;">
                <h2>Hasil Proses:</h2>
                <div id="resultsContent"></div>
            </div>

            <!-- Info Section -->
            <div class="info-section">
                <h3>Data yang akan diekstrak:</h3>
                <div class="info-grid">
                    <div class="info-item">‚úì PO Number</div>
                    <div class="info-item">‚úì Item Code</div>
                    <div class="info-item">‚úì PO Date</div>
                    <div class="info-item">‚úì Nama Barang</div>
                    <div class="info-item">‚úì Nama Supplier (To: ...)</div>
                    <div class="info-item">‚úì Quantity</div>
                    <div class="info-item" style="grid-column: span 2;">‚úì Description (bagian bawah)</div>
                </div>
            </div>

            <!-- Setup Guide Section -->
            <div class="setup-guide">
                <h3>üìã Setup Guide - Google Apps Script</h3>
                
                <div class="guide-step">
                    <h4>Step 1: Buka Google Sheet</h4>
                    <p>Buka Google Sheet yang ingin Anda gunakan untuk menyimpan data PO</p>
                </div>

                <div class="guide-step">
                    <h4>Step 2: Buka Apps Script</h4>
                    <p>Di menu Google Sheet, klik: <strong>Extensions</strong> ‚Üí <strong>Apps Script</strong></p>
                </div>

                <div class="guide-step">
                    <h4>Step 3: Paste Kode Ini</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode()">üìã Copy Code</button>
                        <pre id="appsScriptCode">function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const sheetName = data.sheetName || 'Dataset Purchase Order';
    const rows = data.rows;
    
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName(sheetName);
    
    // Jika sheet belum ada, buat sheet baru
    if (!sheet) {
      sheet = ss.insertSheet(sheetName);
      // Tambahkan header
      sheet.appendRow(['PO Number', 'PO Date', 'Supplier', 'Item', 'Nama Barang', 'Quantity', 'Description']);
    }
    
    // Tambahkan data
    rows.forEach(row => {
      sheet.appendRow(row);
    });
    
    return ContentService.createTextOutput(JSON.stringify({
      success: true,
      message: `${rows.length} rows added to ${sheetName}`
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      success: false,
      error: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}</pre>
                    </div>
                </div>

                <div class="guide-step">
                    <h4>Step 4: Deploy Web App</h4>
                    <ol>
                        <li>Klik tombol <strong>"Deploy"</strong> (di kanan atas)</li>
                        <li>Pilih <strong>"New deployment"</strong></li>
                        <li>Klik icon ‚öôÔ∏è (gear) ‚Üí pilih <strong>"Web app"</strong></li>
                        <li>Isi konfigurasi:
                            <ul>
                                <li><strong>Execute as:</strong> Me (email Anda)</li>
                                <li><strong>Who has access:</strong> Anyone</li>
                            </ul>
                        </li>
                        <li>Klik <strong>"Deploy"</strong></li>
                        <li>Authorize akses (klik email Anda ‚Üí Allow)</li>
                        <li><strong>Copy "Web app URL"</strong> yang muncul</li>
                    </ol>
                </div>

                <div class="guide-step">
                    <h4>Step 5: Paste URL ke Form</h4>
                    <p>Paste Web App URL yang sudah di-copy ke form <strong>"Web App URL"</strong> di atas, lalu klik <strong>"Simpan Konfigurasi"</strong></p>
                </div>

                <div class="alert" style="background: #dbeafe; border-color: #93c5fd; margin-top: 1rem;">
                    <p style="color: #1e40af; font-size: 0.875rem;">
                        üí° <strong>Tips:</strong> Web App URL format-nya seperti ini:<br>
                        <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; display: inline-block; margin-top: 0.5rem;">
                            https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxx/exec
                        </code>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
